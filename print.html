<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Smart Vaults Book</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="Description">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Miniscript Templates</li><li class="chapter-item expanded "><a href="miniscript-templates/decaying-multisig.html"><strong aria-hidden="true">1.</strong> Decaying Multisig</a></li><li class="chapter-item expanded "><a href="miniscript-templates/m-of-n.html"><strong aria-hidden="true">2.</strong> Collaborative Custody</a></li><li class="chapter-item expanded "><a href="miniscript-templates/hold.html"><strong aria-hidden="true">3.</strong> Hodl Lock</a></li><li class="chapter-item expanded "><a href="miniscript-templates/social-recovery.html"><strong aria-hidden="true">4.</strong> Social Recovery / Inheritance</a></li><li class="chapter-item expanded affix "><li class="part-title">Nostr Specs</li><li class="chapter-item expanded "><a href="kinds/index.html"><strong aria-hidden="true">5.</strong> Event Kinds</a></li><li class="chapter-item expanded affix "><li class="part-title">SDKs</li><li class="chapter-item expanded "><a href="rust-sdk/01-getting-started.html"><strong aria-hidden="true">6.</strong> Rust SDK</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rust-sdk/02-installation.html"><strong aria-hidden="true">6.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="rust-sdk/03-features.html"><strong aria-hidden="true">6.2.</strong> Features</a></li><li class="chapter-item expanded "><a href="rust-sdk/04-constructors.html"><strong aria-hidden="true">6.3.</strong> Constructors</a></li><li class="chapter-item expanded "><a href="rust-sdk/05-configs-and-relays.html"><strong aria-hidden="true">6.4.</strong> Configs & Relays</a></li><li class="chapter-item expanded "><a href="rust-sdk/06-profile-and-contacts.html"><strong aria-hidden="true">6.5.</strong> Profile & Contacts</a></li><li class="chapter-item expanded "><a href="rust-sdk/07-signers.html"><strong aria-hidden="true">6.6.</strong> Signers</a></li><li class="chapter-item expanded "><a href="rust-sdk/08-policies/01-index.html"><strong aria-hidden="true">6.7.</strong> Policies</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rust-sdk/08-policies/02-templates.html"><strong aria-hidden="true">6.7.1.</strong> Templates</a></li><li class="chapter-item expanded "><a href="rust-sdk/08-policies/03-custom-policies.html"><strong aria-hidden="true">6.7.2.</strong> Custom policies</a></li><li class="chapter-item expanded "><a href="rust-sdk/08-policies/04-funding.html"><strong aria-hidden="true">6.7.3.</strong> Funding</a></li></ol></li><li class="chapter-item expanded "><a href="rust-sdk/09-proposals.html"><strong aria-hidden="true">6.8.</strong> Proposals</a></li><li class="chapter-item expanded "><a href="rust-sdk/10-connect.html"><strong aria-hidden="true">6.9.</strong> Connect</a></li><li class="chapter-item expanded "><a href="rust-sdk/keychain/01-index.html"><strong aria-hidden="true">6.10.</strong> Keychain</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="rust-sdk/keychain/02-change-password.html"><strong aria-hidden="true">6.10.1.</strong> Change password</a></li><li class="chapter-item expanded "><a href="rust-sdk/keychain/03-secrets.html"><strong aria-hidden="true">6.10.2.</strong> Secrets</a></li><li class="chapter-item expanded "><a href="rust-sdk/keychain/04-wipe.html"><strong aria-hidden="true">6.10.3.</strong> Wipe</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="js-sdk/01-getting-started.html"><strong aria-hidden="true">7.</strong> JavaScript SDK</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js-sdk/02-contacts-and-profiles.html"><strong aria-hidden="true">7.1.</strong> contacts and profiles</a></li><li class="chapter-item expanded "><a href="js-sdk/03-signers.html"><strong aria-hidden="true">7.2.</strong> signers</a></li><li class="chapter-item expanded "><a href="js-sdk/04-vaults/01-vaults.html"><strong aria-hidden="true">7.3.</strong> vaults</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js-sdk/04-vaults/02-creating-a-vault.html"><strong aria-hidden="true">7.3.1.</strong> creating vaults</a></li></ol></li><li class="chapter-item expanded "><a href="js-sdk/05-proposals/01-creating-proposals.html"><strong aria-hidden="true">7.4.</strong> proposals</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="js-sdk/05-proposals/01-creating-proposals.html"><strong aria-hidden="true">7.4.1.</strong> creating proposals</a></li><li class="chapter-item expanded "><a href="js-sdk/05-proposals/02-fetching-proposals.html"><strong aria-hidden="true">7.4.2.</strong> fetching proposals</a></li><li class="chapter-item expanded "><a href="js-sdk/05-proposals/03-approvals.html"><strong aria-hidden="true">7.4.3.</strong> approving proposals</a></li><li class="chapter-item expanded "><a href="js-sdk/05-proposals/04-finalizing-a-proposal.html"><strong aria-hidden="true">7.4.4.</strong> finalizing proposals</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">About</li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Smart Vaults Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/smartvaults/book" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div align="center">
  <img src="SV-Logo-Vertical-Black.svg" width=400/>
</div>
<p>Smart Vaults is an interoperable smart wallet ecosystem for Bitcoin. It defines a specification (with implementations in Javascript and Rust) for managing partially signed bitcoin transactions (PSBTs) and miniscript spending policies over Nostr relays. </p>
<p>Smart Vaults is intentionally designed to work with limited backend infrastructure; the only requirements are a Bitcoin node and a Nostr relay. This makes it easy for sovereignty seekers to self-host their own and simplifies integration for developers. </p>
<p>One of the first steps to using Smart Vaults is creating a new signer key. This must be done on the mobile app or desktop GUI. The extended public key (xpub) of this signer is shared with Nostr contacts that you wish to collaborate with. Signers are encrypted and only shared with contacts you approve individually.</p>
<p>Signers are shared via the Nostr public key (npub), which can be done app-to-app via QR code or via copy/paste out of band. There is also an invite process that prompts a user to download the app, create a signer, and then share it with the inviter.</p>
<p>Now that signers have been share among a group, they can begin creating vaults using the signers. </p>
<p>Currently, the mobile app and desktop apps are the only supported signers. Our initial focus is optimizing for easy and fast hot wallet approvals for vaults. However, users can have multiple signers and we will support hardware wallets in the future.</p>
<p>When a new vault is created, an encryption group is created for the vault participants to share information that only they can view. This includes the vault configuration (spending policy), name, description, spending proposals, and utxo labels.</p>
<h2 id="proof-of-reserve"><a class="header" href="#proof-of-reserve">Proof of Reserve</a></h2>
<p>Smart Vaults supports proof-of-reserve attestations on vaults. These proofs can be generated to cryptographically prove that the members of the vault have key access and ownership over the vault’s set of UTXOs.</p>
<p>Regular proof-of-reserve attestations are an important component of custodial hygiene, especially in multi-party or multi-institutional custody vaults.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="decaying-multisig"><a class="header" href="#decaying-multisig">Decaying Multisig</a></h1>
<h2 id="description"><a class="header" href="#description">Description</a></h2>
<p>Decaying multisig is a custody technique where the number of keys required to move the funds decreases over time. For example, a 3 of 3 multisig may decay to only need 2 of the 3 keys after 1 year, and then to 1 of the 3 keys after 5 years.</p>
<p>One use case for this is mitigating against loss of funds due to key loss. If a key is lost, the owner only needs to wait until the next decay step to recover the funds. Another use case is for loosening consensus for co-managed assets. For example, a board of directors may generally require a higher threshold (67%) to spend funds, but decrease that over time (to 51%) to avoid allowing a subset of signers to deadlock the funds.</p>
<h2 id="vault-configuration-example"><a class="header" href="#vault-configuration-example">Vault Configuration Example</a></h2>
<p>All 3 signers are needed to spend. After 10,000 blocks, the <code>after</code> block meets one of the threshold's conditions, so only 2 signatures are needed to unlock the funds. Finally, after 20,000 blocks, 2 conditions are met by the <code>after</code> statements and only 1 additional signature is needed.
<img src="https://github.com/smartvaults/smartvaults/assets/32852271/199630b1-8812-45ce-9d44-6f2a35e030e6" alt="image" /></p>
<h2 id="inputs"><a class="header" href="#inputs">Inputs</a></h2>
<ul>
<li>Threshold</li>
<li>List of Signers (extended descriptor)</li>
<li>List of Lock times (integers)</li>
</ul>
<h2 id="miniscript"><a class="header" href="#miniscript">Miniscript</a></h2>
<pre><code>thresh(
    &lt;threshold&gt;,
    pk(Key1),
    pk(Key2),
    pk(Key3),
    ...
    after(Timelock1),
    after(Timelock2),
    ...
)
</code></pre>
<h2 id="output-descriptor"><a class="header" href="#output-descriptor">Output Descriptor</a></h2>
<pre><code>tr(InternalKey,thresh(3,pk(Key1),s:pk(Key2),s:pk(Key3),snl:after(Timelock1),snl:after(Timelock2)))
</code></pre>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<p>Example Output Descriptor</p>
<pre><code>tr(3ec243044db203bc418092014b46bfe9494a1c16ee66160e385d7dd676e378cd,thresh(3,pk([7356e457/86'/1'/784923']tpubDCvLwbJPseNux9EtPbrbA2tgDayzptK4HNkky14Cw6msjHuqyZCE88miedZD86TZUb29Rof3sgtREU4wtzofte7QDSWDiw8ZU6ZYHmAxY9d/0/*),s:pk([4eb5d5a1/86'/1'/784923']tpubDCLskGdzStPPo1auRQygJUfbmLMwujWr7fmekdUMD7gqSpwEcRso4CfiP5GkRqfXFYkfqTujyvuehb7inymMhBJFdbJqFyHsHVRuwLKCSe9/0/*),s:pk([f3ab64d8/86'/1'/784923']tpubDCh4uyVDVretfgTNkazUarV9ESTh7DJy8yvMSuWn5PQFbTDEsJwHGSBvTrNF92kw3x5ZLFXw91gN5LYtuSCbr1Vo6mzQmD49sF2vGpReZp2/0/*),snl:after(1721743844),snl:after(1747663844)))#p0skyz4j
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="collaborative-custody-template"><a class="header" href="#collaborative-custody-template">Collaborative Custody Template</a></h1>
<h2 id="description-1"><a class="header" href="#description-1">Description</a></h2>
<p>Collaborative custody allows users to configure the number of co-signers and the threshold required to access the vault’s bitcoin. </p>
<p>Users can choose a 2 of 3, 3 of 5, or a custom configuration, this feature ensures that multiple trusted parties agree before a transaction takes place. It's an ideal solution for shared ownership and collaborative arrangements.</p>
<h2 id="vault-configuration-example-1"><a class="header" href="#vault-configuration-example-1">Vault Configuration Example</a></h2>
<p>TODO</p>
<h2 id="inputs-1"><a class="header" href="#inputs-1">Inputs</a></h2>
<ul>
<li>Threshold</li>
<li>List of Signers (extended descriptor)</li>
</ul>
<h2 id="miniscript-1"><a class="header" href="#miniscript-1">Miniscript</a></h2>
<pre><code>thresh(
    &lt;threshold&gt;,
    pk(key_1),
    pk(key_2),
    pk(key_3),
    ...
)
</code></pre>
<h2 id="output-descriptor-1"><a class="header" href="#output-descriptor-1">Output Descriptor</a></h2>
<pre><code>tr(InternalKey,thresh(3,pk(K1),s:pk(K2),s:pk(K3)))
</code></pre>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<p>Example Output Descriptor</p>
<pre><code>tr(885db1e89516e0f0adc15ff8389320a01270a54f3b8ea4ecc705472904fc9a7e,multi_a(2,[7356e457/86'/1'/784923']tpubDCvLwbJPseNux9EtPbrbA2tgDayzptK4HNkky14Cw6msjHuqyZCE88miedZD86TZUb29Rof3sgtREU4wtzofte7QDSWDiw8ZU6ZYHmAxY9d/0/*,[4eb5d5a1/86'/1'/784923']tpubDCLskGdzStPPo1auRQygJUfbmLMwujWr7fmekdUMD7gqSpwEcRso4CfiP5GkRqfXFYkfqTujyvuehb7inymMhBJFdbJqFyHsHVRuwLKCSe9/0/*))#g52crz77
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hold-template"><a class="header" href="#hold-template">Hold Template</a></h1>
<h2 id="description-2"><a class="header" href="#description-2">Description</a></h2>
<p>Hodl time locks let’s user set specific time intervals, with a maximum of 24 months, during which their bitcoin remains locked. </p>
<p>The hodl time lock feature prevents impulsive selling during market fluctuations and allows users to stick to their investment strategy.</p>
<h2 id="vault-configuration-example-2"><a class="header" href="#vault-configuration-example-2">Vault Configuration Example</a></h2>
<p>TODO</p>
<h2 id="inputs-2"><a class="header" href="#inputs-2">Inputs</a></h2>
<ul>
<li>Signer key (extended descriptor)</li>
<li>Timestamp or Block Height if using an absolute timelock (<code>after</code>), number of confirmed blocks if using relative timelock (<code>older</code>)</li>
</ul>
<h2 id="miniscript-2"><a class="header" href="#miniscript-2">Miniscript</a></h2>
<pre><code>and(pk(Key1),after(TimestampOrBlockHeight))
</code></pre>
<h2 id="output-descriptor-2"><a class="header" href="#output-descriptor-2">Output Descriptor</a></h2>
<pre><code>tr(InternalKey,and_v(v:pk(Key1),after(TimestampOrBlockHeight)))
</code></pre>
<h3 id="example-2"><a class="header" href="#example-2">Example</a></h3>
<p>Example Output Descriptor</p>
<pre><code>tr(e3e5c4a66d85841b9cea26793ef640bf7c1d26e759ae0296e643a16dad606c02,and_v(v:pk([7356e457/86'/1'/784923']tpubDCvLwbJPseNux9EtPbrbA2tgDayzptK4HNkky14Cw6msjHuqyZCE88miedZD86TZUb29Rof3sgtREU4wtzofte7QDSWDiw8ZU6ZYHmAxY9d/0/*),older(10000)))#e4gyn573
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="social-recovery-template--inheritance"><a class="header" href="#social-recovery-template--inheritance">Social Recovery Template / Inheritance</a></h1>
<h2 id="description-3"><a class="header" href="#description-3">Description</a></h2>
<p>Social recovery keeps you in full and exclusive control of your bitcoin while enabling a recovery path in case you lose your keys. After a predefined number of months set by the user, an m of n multisig of trusted co-signers is able to move the user funds</p>
<p>Between 20%-25% of all bitcoin has been lost forever by owners who lost their keys. This security feature helps you have a plan B, leveraging trusted connections like friends, family, or colleagues to regain access to your Bitcoin</p>
<h2 id="vault-configuration-example-3"><a class="header" href="#vault-configuration-example-3">Vault Configuration Example</a></h2>
<p>TODO</p>
<h2 id="inputs-3"><a class="header" href="#inputs-3">Inputs</a></h2>
<ul>
<li>Signer keys (extended descriptor): 1 + N for recovery</li>
<li>Timestamp or block height if using an absolute timelock (<code>after</code>), number of confirmed blocks if using relative timelock (<code>older</code>)</li>
</ul>
<h2 id="miniscript-3"><a class="header" href="#miniscript-3">Miniscript</a></h2>
<pre><code>or(1@pk(Key1),1@and(thresh(2,pk(RecoveryKey1),pk(RecoveryKey2)),after(TimestampOrBlockHeight)))
</code></pre>
<h2 id="output-descriptor-3"><a class="header" href="#output-descriptor-3">Output Descriptor</a></h2>
<pre><code>tr(Key1,and_v(v:multi_a(2,RecoveryKey1,RecoveryKey2),after(TimestampOrBlockHeight)))
</code></pre>
<h3 id="example-3"><a class="header" href="#example-3">Example</a></h3>
<p>Example Output Descriptor</p>
<pre><code>tr([7356e457/86'/1'/784923']tpubDCvLwbJPseNux9EtPbrbA2tgDayzptK4HNkky14Cw6msjHuqyZCE88miedZD86TZUb29Rof3sgtREU4wtzofte7QDSWDiw8ZU6ZYHmAxY9d/0/*,and_v(v:multi_a(2,[4eb5d5a1/86'/1'/784923']tpubDCLskGdzStPPo1auRQygJUfbmLMwujWr7fmekdUMD7gqSpwEcRso4CfiP5GkRqfXFYkfqTujyvuehb7inymMhBJFdbJqFyHsHVRuwLKCSe9/0/*,[f3ab64d8/86'/1'/784923']tpubDCh4uyVDVretfgTNkazUarV9ESTh7DJy8yvMSuWn5PQFbTDEsJwHGSBvTrNF92kw3x5ZLFXw91gN5LYtuSCbr1Vo6mzQmD49sF2vGpReZp2/0/*),after(840000)))
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="kinds"><a class="header" href="#kinds">Kinds</a></h1>
<p>In the current protocol (<code>v1</code>) all objects (<code>shared keys</code>, <code>vaults</code>, <code>proposals</code>, ...) are encrypted using <a href="https://github.com/nostr-protocol/nips/blob/master/04.md">NIP04</a>.</p>
<h2 id="9288---shared-key"><a class="header" href="#9288---shared-key">9288 - Shared Key</a></h2>
<p>This kind it's used to share shared keys between participants of a <code>vault</code>. 
It's used to encrypt and decrypt everything related to a <code>vault</code>.</p>
<h3 id="required-tags"><a class="header" href="#required-tags">Required tags</a></h3>
<ul>
<li><code>e</code>: event ID of the <code>vault</code></li>
<li><code>p</code>: public key of the user able to decrypt the content of this event</li>
</ul>
<h3 id="example-4"><a class="header" href="#example-4">Example</a></h3>
<pre><code class="language-json">{
    &quot;content&quot;:&quot;PDj1bNB1PuWKzPc1RrKBmbEeXDaYkxRIsAqTraJscUq4ML3+mZzJq4O6vPkkIJeZuNQTp0EyLxAvUblXCgJxaEgwxRWQC+rpdz3ILjdQA2w=?iv=B5KnzXU7smmAWevhTi1rSg==&quot;,
    &quot;created_at&quot;:1693903672,
    &quot;id&quot;:&quot;6bc1eb162aa5d0623370d808578d15a77e1e91a55ee93255ec070d5e03b4c87f&quot;,
    &quot;kind&quot;:9288,
    &quot;pubkey&quot;:&quot;f831caf722214748c72db4829986bd0cbb2bb8b3aeade1c959624a52a9629046&quot;,
    &quot;sig&quot;:&quot;ad9bc22082b5b5d23b75bb3752109b1d6d97a7ff29f1effdc710943c69f7550479856c06e76e4361e033be7400a27a9e688b3a4cf417840b7dd2b0df1403ec39&quot;,
    &quot;tags&quot;:[
        [&quot;e&quot;,&quot;071dd01141b000f7d0c9f8172101e8efb5771939456d8e4a3f8b37f6d458e82d&quot;], // Policy ID
        [&quot;p&quot;,&quot;f831caf722214748c72db4829986bd0cbb2bb8b3aeade1c959624a52a9629046&quot;]
    ]
}
</code></pre>
<h2 id="9289---vault"><a class="header" href="#9289---vault">9289 - Vault</a></h2>
<h3 id="required-tags-1"><a class="header" href="#required-tags-1">Required tags</a></h3>
<ul>
<li><code>p</code>: public keys of the users involved in the <code>vault</code></li>
</ul>
<h3 id="example-5"><a class="header" href="#example-5">Example</a></h3>
<p>Unencrypted content:</p>
<pre><code class="language-json">{
    &quot;description&quot;:&quot;Vault description&quot;,
    &quot;descriptor&quot;:&quot;tr(...)&quot;,
    &quot;name&quot;:&quot;Vault name&quot;
}
</code></pre>
<p>Event: </p>
<pre><code class="language-json">{
    &quot;content&quot;:&quot;uTK3M5F958K1HKEJf/8ciVNLVw0u6dwkSANxWGBkZvpM3/3kIR/miLUPGuYLskl8ttBcLRXU07fq1mhC0+PsppJo5PQ3XyWFGWGWOQXktOKPIhpQcbpX6xCZACKN9BP6x1kCt8RCJB8nwqx0mD21syZRoQdOqKXWR/1r4rqknMS4uPY3nwT15vkP0p6zP6ZD4m9ykBhiRhGiUYxdakMcKcfHt1R22OF0trCt1+KpL9cdVqHpiiJy9hofgKb7wqPFnwcoRVlariXoQIIOoZHzOS69rzmqLFAyz6PWl2ifSwhDX9VCMw6vzp8Trp0lO/txhGW6+mIn9DBebj0cJQCygUaUmpzyBXOAzuzndUDPHMsls12qeOfX64edLgGyC/jL7qG9HS6Z1Wo91jlpqwTmqY3yzMGGcMZ01VkJ0jmbB8OuuO/BfrU3YMLQMAXMyc8BVyyksNIrG9tEMJlGDe4w1Wl2Ss7jiZRqLzuJua7w0RpApAmQ8zAsaDojVOEES87/pG+Pl6EyQxnofMMmdi1A+LSBQBAjtglGdKaK740I6Cjc2acBwqohiM8CV+tbTCqn?iv=fPuKqXaCoczpZ/3eikrTbQ==&quot;,
    &quot;created_at&quot;:1686479425,
    &quot;id&quot;:&quot;9e0dfd2177ea9357f0c165ed134a86a3c07449676d8315e12d159932ff428e37&quot;,
    &quot;kind&quot;:9289,
    &quot;pubkey&quot;:&quot;4639e297633117888df17deed6b3860ff152e9e464690623b6b3d6ae4923ad62&quot;,
    &quot;sig&quot;:&quot;2ff3f48a7e80db25418df983c732edbc495b0fb28f4fdf051955867c0e180131f7f7e9499957adee76bc9fdedc5fb7c8a71ec7e1655322e39cf5d4f590bfcd15&quot;,
    &quot;tags&quot;:[
        [&quot;p&quot;,&quot;3eea9e831fefdaa8df35187a204d82edb589a36b170955ac5ca6b88340befaa0&quot;],
        [&quot;p&quot;,&quot;f831caf722214748c72db4829986bd0cbb2bb8b3aeade1c959624a52a9629046&quot;]
    ]
}
</code></pre>
<h2 id="9090---proposal"><a class="header" href="#9090---proposal">9090 - Proposal</a></h2>
<h3 id="required-tags-2"><a class="header" href="#required-tags-2">Required tags</a></h3>
<ul>
<li><code>e</code>: event ID of the <code>vault</code></li>
<li><code>p</code>: public keys of the users involved in the <code>vault</code></li>
</ul>
<h3 id="example-6"><a class="header" href="#example-6">Example</a></h3>
<p>Unencrypted content:</p>
<pre><code class="language-json">{
    &quot;Spending&quot;: {
        &quot;amount&quot;:1928,
        &quot;description&quot;:&quot;Proposal description&quot;,
        &quot;descriptor&quot;:&quot;policy-descriptor&quot;,
        &quot;psbt&quot;:&quot;base64-psbt&quot;,
        &quot;to_address&quot;:&quot;mohjSavDdQYHRYXcS3uS6ttaHP8amyvX78&quot;
    }
}
</code></pre>
<p>Event:</p>
<pre><code class="language-json">{
    &quot;content&quot;:&quot;ShT2G9QmydYwcYEfqdXQvLYKSP4Gi4AfxL0XrtuO9C6y64wp+nHYQQ0IOZdA7YTtkfQ8n5c8/ZLJkjl3oJosVGbmrT/7H98Q+wM3IwFBKlOTdzq8g6Cdjx6lMfmm+wfysLu3X+ZN6xO6vK+cXCZpNeShChnC52uaVfd4afNG9qUsdGGPueQoX/TpmjHLRd/v4HfOf+aAGJalNNpHxugK4XR/Tb5zCMrLkMT/JOdz4jIFV71FZunyCvT/Iafz4aN1hUhFJjG/ERueSsOdRJpdkI/15M4rOMBgWm4/kW6MKGgTRFO5yLin0C4oqHmDb3urPTDirTk2ENDgZ0nhj6GcpjDNg92508fUkdjTcu6Td4stK3VLsSAhyf/KECXC87mvn5F8r0SkJGUHDbgtG7yFd8RMg5gJ77+wP4NdpFIuJ8Yiziz3KWY6Q1dSMpsPrgvLtCuRsyaR6rxISt47ELrUY/U0vruz26LCAILF0G7MyAEkeK6bgHZPWow07jCBJ7V9bBPrCCDsGpzekLO/cqrsSV8qGK1hvwCZ51CCf6OFdWoRagsTO/uqxts+CddGhFbQZQB3LiSU4Pd/Vm1RoajAm7YEWU+DT+eGPMvavWGIAFrYzrXZi8LL49YI2K4+0hvhgoQKUI7YiFM7ZhfohA0Utrv+JDjD7jIQjgVM7HpZoP5p4OOOd/YeMl3XqsaVnSUZDfj8Vs8bXgu7TnhibkUEhR8NqxuA5f8EmWjlwMuxwQP7HoIfhSIpyki6JnPPt7vKhVn8hBOFbhbbrRO2cw2jFezHmcbGcQV4R+QCmaRK43iWgbG3Yu3uZ8qZnjeLfl/BJHf61gruzC8CYphTSBUIjlA16IjcH24B9TO02b76EIBDsNoOAB3KKeb7t0glIAS4XG1fXX4WgJdEwp8ehCttUyo55FYDT8+jeO2REYxc401JtsPAF9e6Y9Xk/xYkOvjziFXz+n/9ygH4j5LW0PPsWMybSttYsm1X+O2icHiWrNnKufCACMJMStGC2TnUQkVWZMQE8n+UEsrWopKEzkKwsF0CmbhQ2nPfN7xZm1Z2mKNMvG/J53Ig3x5TlOKRTcd7aksX2F+d24pkr78DdaExnUixY7DR3YVBqitiXcRr+nJdtu5OqkVpqejk3jU6EDBbL2PE+A3/qAfuMGZ+DhAQaHw+lDBveFY0DpmcI1N7+84vaj4vCtXonVnZ5Tz1xHyn3I+J+Ud7UWctRUD86JLeCVlZEzqOQwrhZ+G9JctnPVlBs2D2JSwjtAkg4kXcgHOq7+d5zGdPk3uW4xABj4nuDZ3SqxhwaGbz2+8uzKMBoq6vNx8bIl/oDKSZl43rXfr91BdeAgneXUfTaqlAwdNpXqVHAduZTQpkeX7jS84IrzJ7yT2wIehC6tEXqZVEhpZzO3AhU7dacEv4JdN/k3rRNbXAwQhoeTs+25DXjXkhnvV5OD6LNMDm6EtH+eeGZPvx6YlvADi2XAXh/1QQJVkNof+miH5wmIAtwI1PnKFu49mXAvDSsC6a8xgKZCdeu+VuhoDL4WGxo+DoPTAYL4cuk004MXmIrxjTLF22gzPPmuUCCpYbJZplXY3Ax/f6LY69RfVPeyxZIPOOGQWPHPDW8lYgoXlBMHaYdMkUqiSAJ2rml46HjTLz38l+eMq5yNCNlZnHuk/s7eaRpTVdKQ6IW6gPgCeNNGxvoEAhL4ZtdM3PRKXbZYvM9CEZ7IUT8Izg84kCayvh3AqFfR/2htl8EK4jpP3JEwak8I2j87vTH8bmjXqJxJV0gClwdn01bqWmZ1Z6xIkBTFrThyrOPrrmKqlllN1uoCOODufUv6DaEbg7iy7v7iTSq5k7MGAyPRYJt4qlX3yuI3s1p/7XuO45YqPiweZNnDDDghesWncYuTEK2wOND0QUpI2lgtSKHYPx0akNjjRE8hcQ89iAWZl+XQwNsEIKJkT3ZlJpMUG2VjYRRkmHRmN/Wkq+7geYz4bm07P2lCu8Pcge5qR3SLcorE7ykmzvFGo3JnE3vmFzcMtxBFq0hReY2wlsyECCzLQogCSVc7xw4jjNZCoFIw1G4gGxg18ed6uP1jUdqvVtF7pON18SusTjXJ7ggZaFmfQwFb7PcrpnWfJnrDexA22rBsja3RmJLJcms43Aozs6sksrYlU7ObCebP3KBFV5gGFbXR4T+rDmNlFDf6lC3rgD2OvMIGvT4f2fS3QaG2ZUCMFObNv2wwK8nKouoTQ+zEWKVyVflapsTKQ7vPMC4yO+C76aafbrzYvbtYWYCsL4uHnuNgUDg+rHHNqe51fIUhQOwdgWJ7+kmjHJO0U1UiD/xKjfqnixR1S8mx7zoMD+521hk+SVR33f3+K5CtFGITSBjJnLTugb1IL8wSkImwivj8gdgj5XZ9Gc4WKpiB/rNOQjPPmVTae+EKT1Sii5/kA5cXyPXq30igkFFwhyovzmqXt7l9szBW4U8Sj64lgfen7DCN2JBU1XCSXMeP9g5B/sv/lLKEOnFQLDJGH76U9M01hi/8ZFflgsxRE2ZgBECz3ehnCePKxNup692sR3Bog6w0Pz+4QjJRrEYrZmXoLLEX5dk9qc36NxxJm1Jo+BWvUerVcS0S8jkyh1kep5MVhBF3ey1nxwoBxnz5EtWsZhnf3An6D/ZvfaydXwFvJ1a77Hnh+YwtDC6r9yIyrmqHfvikg8fO1Rq/KLR0oI/vjEg5aldJVO2+gRBHsdgzXaX/2p9bz8ZIPDs4/8C2ShuwJc5HDj8hiro5yscpuQNnPSo1apWUdGt/P0u2AnhPXjid57gLYynDs50k7fzxXJvBDU2b4CS91NMuXWg6nIXI4XwQ+x94ZNOQGXInf1aFO4Vt6vA+8Bb6I716vkQKHFZIacqJpuddRQfqQafeXfzeUWtcReolxdsDr58rVlAiWqjILwAZJlaGpZneg9S9hz7Nl/pq1a7FcFGOhUm4/fHHm/efHENmi+JlHj9D8desRwenOda1BkjMjumSovLjltNrq+177z4iiROXqW//ViefV9eXHX0s7YQM3NOOldErYCP6gs1VQrvZPth9vwbjtuLBKEvMGqvSzrNxdTSuWopr9gPpz00mtaR508entx6l0DdK/WpduztyFvZLRm0d92egk7L0Mr2phmIB4kmDyh9VibdA5bGzKRCQJsIWaCTVs17Qw=?iv=whier1QoEXYwFJhwcpcl3A==&quot;,
    &quot;created_at&quot;:1694781913,
    &quot;id&quot;:&quot;726e919e26dcc70dbc3926660afa589793233ca6c94e69f9687fd03c02f74263&quot;,
    &quot;kind&quot;:9290,
    &quot;pubkey&quot;:&quot;4639e297633117888df17deed6b3860ff152e9e464690623b6b3d6ae4923ad62&quot;,
    &quot;sig&quot;:&quot;5c88ff5bf65fe8da798bfd8303f493040055748d6c06d623b26393d78631edc0dadd79a4cd6f10930feb43d23900390c7dabbf5287c4a32b8c0970a6a3e9d0c1&quot;,
    &quot;tags&quot;:[
        [&quot;p&quot;,&quot;3eea9e831fefdaa8df35187a204d82edb589a36b170955ac5ca6b88340befaa0&quot;],
        [&quot;p&quot;,&quot;f831caf722214748c72db4829986bd0cbb2bb8b3aeade1c959624a52a9629046&quot;],
        [&quot;e&quot;,&quot;9e0dfd2177ea9357f0c165ed134a86a3c07449676d8315e12d159932ff428e37&quot;] // Policy ID
    ]
}
</code></pre>
<h2 id="9091---approval"><a class="header" href="#9091---approval">9091 - Approval</a></h2>
<h3 id="required-tags-3"><a class="header" href="#required-tags-3">Required tags</a></h3>
<ul>
<li><code>e</code>: event ID of the <code>vault</code> and the <code>proposal</code></li>
<li><code>p</code>: public keys of the users involved in the <code>vault</code></li>
</ul>
<h3 id="optional-tags"><a class="header" href="#optional-tags">Optional tags</a></h3>
<ul>
<li><code>expiration</code>: UNIX timestamp of the expiration of the approval</li>
</ul>
<h3 id="example-7"><a class="header" href="#example-7">Example</a></h3>
<p>Unencrypted content:</p>
<pre><code class="language-json">{
    &quot;Spending&quot;:{
        &quot;psbt&quot;:&quot;base64-psbt&quot;
    }
}
</code></pre>
<p>Event:</p>
<pre><code class="language-json">{
    &quot;content&quot;:&quot;xTv+0Vw4fzB3Kt5x6LK9rjnbIG7sL7J1J+nvoA1OmBw4ERa/8xvqQKv4DWkjDpy58cHYrtidnIcYeNsG0ATQ1p5VSlpqb4bw4RS2OpMT7MbTqS5jSTqpOTSSeu2zDc2yF0+VE3GgDydrt5ck5Hx8rdkPkAJ+rLJ4tcAUBo53gMzTBJ/wGMFTTsVK9w6nSq43ERfow3fzoxwUIru9gBbOFoYg+svqPByL/GvIuvjTPPHGzimQxdTqkkmAy+pjSTYE/UJ4rVbmuerdoQAH87cYwWmpcPaF0hbsvV2071DhMJjHFASN0L/1zjRYZheddDZNT9ePyv6tHQ4RczJF4apR8lyUEJp6wECU6/xFy5dXMn0a6VDrPFJ8s9A3dSD+6CkCI1o3wIBlixPDQUDtNN69h1ZMJhDbiirFXsAYy9nkA5LGDYhUw9mdB8NG5friFxthZW1cwWYm/uudUAreOJBtUaNqNLhwfxvgnDjDjUrgOnT+DxRllsnLoshuv0IXwcYp5dYtiD/e30lEefdeZ4CrIfQdZkndpIBfcwBJG0RUNgfOdkVgurhhxuKFp3/oHaW8X+EnIW6EQRR0ut4PQJFglQtjGJjUlZ5yb/IBGvGnVfgGXLThN0hiA5QP78CBWinkEbPL/Z0mOI6bLkVW4Zo+xt4Pntxh2k4PSO5SizuZz7EWkmTt9Jxq+597T7Io6t6m6Kx7ryURN1OPwSGEXdxyRkIOcwxOsD2RILvwxF5h/Mt/Z/oyJ0ylUTTyxkkAbzluhtjlLyC1lzmE6L0U4P9/iK/7TMequnT24Rtt44HggpYP7d9a9dasvCDiZLUvxLGnjKN7RAoxQb1j9zELOl0LKem84/e5vIIeobYaH000FYiup1imxPZJ+Ufd/K6Coxf7YQY7TCqP79xLGteM2saium8WP3IH9yd4R/g7fxFVTt37S/Ys67HHNgmDx6fzb5NOgwTs/Iz8IO4LMiXVZAoJJ5cC+6lwbgNuuSvQ50g67NdY+NLWyVofFY3TJkkx/bXeracUlJrxKJG4jYQhm41z4/UKCFnAf5uq+6aDoWUpyNu2QB4Z+6glYH5IyJz2XgbZBz1zjWb4BCc/tT17J9UCn/B1OIKLFnHl+2tLR0T8/ZN6cwRlA/o3S9vTmNbu5QtvEqXxlE+r9OasCwPXrmV2QdYw8I/h1XzbDFPK54UGJVxy1P3CM0oGtnCibaZdFyslAr/R+l79NHw64ApuEhP7ZNHTFxB2yLfMAcAYf6fuqw0YxJiV78ui1fSue4IUV6+wlPFKBfz/RqTG0zkmZId8NPiPXUCzy7wMvZwcTZFEhZOUijlxLBWMwr3tXYzJHUbWfzHrhwued68SWw0AinUeP3mkREju0uo7ja6pKKFtAhP+VzO9ZqqTA+VDAIlNmvFw4aela8MLbgNCpVDNI3wxj3fb0PpWjmETG1DrDPpkYlpBBBRemFOOhhwcLx4kjNqKr4db1cYN/A5wWe6QXOTPs9EeyrWQXGOIxNgQA0+VJJeynmXGxZ2Vsb+mhj/X7XHyVKOl4yAvx9xqe+kMsDg7Ww9bT2jiIJ0kqOjxZmusa3v/naV7rGjKRbkBE7U4xdsgfb+Z7wIBo0qkSQyMYqDt2L26Nj77pQkCjvitpm0WULl5hTJMCnTxtE8io/C3TsVQ1PaKWYNAJi9W/OcOmgPH1gq+EKmgrgi1sfUk2KXEVALQWncbSZtBAqMLtsH3R0+I//03VbeMFFvWXi7yDfVBE5iCUPcVpPFYSsrTdCHu6f5QMTukIn2xplKsAK6tk7hMfZ+3u9yzlC3M1GCe7PSm+tLlYSOxkB1smmWn/ZLF1dYuoAyGbwGG+wL2J+GpjOO0u5LqZpO202CVhT9hZ178HjvDMYVqR7SIfnVR4mAIkvfvnoMYTJBEKjT9fKJNJCgi?iv=3uD9CK7zc9OTGN8VGyKqtw==&quot;,
    &quot;created_at&quot;:1694703253,
    &quot;id&quot;:&quot;728e7aa746d4c207f118576d41908e92788616b86ae9108d3249fced0023168b&quot;,
    &quot;kind&quot;:9291,
    &quot;pubkey&quot;:&quot;f831caf722214748c72db4829986bd0cbb2bb8b3aeade1c959624a52a9629046&quot;,
    &quot;sig&quot;:&quot;7d6219e097559ad0b3ac8a5e7529a4f709cf0701d2003cc8ecacb829a3db723c819a0254b012faaddfd67ce690a7437c8cec01c90f94cf76472919e8a31a85ba&quot;,
    &quot;tags&quot;:[
        [&quot;p&quot;,&quot;3eea9e831fefdaa8df35187a204d82edb589a36b170955ac5ca6b88340befaa0&quot;],
        [&quot;p&quot;,&quot;f831caf722214748c72db4829986bd0cbb2bb8b3aeade1c959624a52a9629046&quot;],
        [&quot;e&quot;,&quot;e64282e3491ebf5de5ca499bd211d5a26d1636d3197f7341d6eef804ed0a61b0&quot;], // Proposal ID
        [&quot;e&quot;,&quot;9e0dfd2177ea9357f0c165ed134a86a3c07449676d8315e12d159932ff428e37&quot;], // Policy ID
        [&quot;expiration&quot;,&quot;1695308053&quot;]
    ]
}
</code></pre>
<h2 id="9092---completed-proposal"><a class="header" href="#9092---completed-proposal">9092 - Completed proposal</a></h2>
<h3 id="required-tags-4"><a class="header" href="#required-tags-4">Required tags</a></h3>
<ul>
<li><code>e</code>: event ID of the <code>vault</code> and the <code>proposal</code></li>
<li><code>p</code>: public keys of the users involved in the <code>vault</code></li>
</ul>
<h3 id="example-8"><a class="header" href="#example-8">Example</a></h3>
<p>Unencrypted content:</p>
<pre><code class="language-json">{
    &quot;Spending&quot;:{
        &quot;description&quot;:&quot;Proposal description&quot;,
        &quot;tx&quot;:{
            &quot;input&quot;:[
                {
                    &quot;previous_output&quot;:&quot;57bd3e5dce42855346698ed6afc5acb65746abfda56e93db11ffa8be3677f612:1&quot;,
                    &quot;script_sig&quot;:&quot;&quot;,
                    &quot;sequence&quot;:4294967293,
                    &quot;witness&quot;:[
                        &quot;6cb594a167ba0266f8e7a0d774089da0d6b0213f9838667edf3c65bfa232c2c0b2c11f71902d17343faea56ac1f48299b35095f6d8967b6881d0741029e18216&quot;,
                        &quot;e0b5eacc5044729bfbc79bbc3ca79f3f9c355400334d4a9b5890353d3f9027f8cc91233f677bf049e75d7ba3ae3499186c61f5b7521460f28119e078222d63a1&quot;,
                        &quot;209125b5661a3388ab58218ef1f7fa6530fcc1fc450fd2bc2465f020037655bc5fac206cdbe7b03576c53da1deccd58f0605406d270df70bf925bafc9553672148e997ba529c&quot;,
                        &quot;c00202020202020202020202020202020202020202020202020202020202020202&quot;
                    ]
                }
            ],
            &quot;lock_time&quot;:2502480,
            &quot;output&quot;:[
                {
                    &quot;script_pubkey&quot;:&quot;76a91459cada50314c829e19f5a7786f8ee0d4987f429d88ac&quot;,
                    &quot;value&quot;:1896
                },
                {
                    &quot;script_pubkey&quot;:&quot;5120045a52300c0628547fd851543dc9a0fc653b75bd7136d326a736a649251838f7&quot;,
                    &quot;value&quot;:5594
                }
            ],
            &quot;version&quot;:1
        }
    }
}
</code></pre>
<p>Event:</p>
<pre><code class="language-json">{
    &quot;content&quot;:&quot;vMg2YFd3xXhNbLt+IK81FoBfvztBSLjEEiXzeTrYDrhOGmjhmNorLCl8JsRdjjMl1mULdX6UGmu1bQq3EY2v/HNLiiHfb/TU1LhD+XOXvRBUCQToEguarQcknVqVSry7GzIH+J0z6aT/DbYzMpWeA3g6q3HMBs6sj5QfBb6DokUKbFadq74CDnHoEgQ9qhcJaL3qZXL5g01J47u1ceHW+G6/iTEH+TFBKw4iQhdzFH+GyMugow3EmSvuPiiVFr+ZI6iAo14DqqjKKC41XW5wnFeZ2TZTbTHDqnTQrguvfULCpP7p7yOFKlnTUzd0Mgw41xB7FUFCkAmIpZaMNQErCIp0/PTtBZheUM9GHFvuJO3gmZ2B4b4HlbFEpNQ5S8+aYxIOaawLYKbdV7CNjE/hwB2ZQbDLB/UcQ8mbYzkEh6z2bARTCKoiqpNhIyj+OjZbkYjFm/J0ZDAOc8kSyuSqOXGyrtbL669ZBSRXxDkagBmX2lFJ3FZmDsWUbWDtY6IZsCIZDwncVH/P+hU1zUAh+vvdHtt4TSJ+4Iclg1sv9c/Rd/esgjlh4SMav/HBsjkGeaiifRP+rDq5JYRJZi+7xkna9vak1ClBBJL6NUpx87a3h3D95XcRBQQidJhCAMk0Smil5IOB7iz1H71SsJ88+mVNvw0S6Nxy2qfA3FU9j4Kz7X5+F74dHy4UHbn9GCCjNNCQXyZ8S1A/WtQQCv89Gnv99QcX6wkZtVpJ8dLsGUBzZ78xYkfjagzfj2idAxrlCTWmn7fdkc4ZWEzr6JE7GOnLyrjerfVZzecp5kuTM+7j170rLGgnOpt68MSTC7q68M3AwLW9/0s5iC5tMmZJuLnUvMg6A2ZSLr3IaDIazOgH3EbK3RsZ4AUwTRwiCYwu7LQTsiRMvAIG0wrfe3Ldb9G9qHyo5KgNr1CAb7upip0/HL04aNJISn5qEO/cCNM0nW2S41h+Xr9p6NDngnNPnLXC/r+Y1wSEt2bHuemlzC+BUZxsFG300bEpQMsiYJQFmj2JezmLkwLZSEhIPM7KsZ9HbjfowhAe1wF/hZ1iRDzCjknBu1LZcdQhe5Ptu6T2?iv=C4jXF0j5ldeCO6hv9Zajlg==&quot;,
    &quot;created_at&quot;:1694705897,
    &quot;id&quot;:&quot;9a0cce3a14184cbd575ea8ef5f61caa1da830320ab8222902eeaf701bd20677a&quot;,
    &quot;kind&quot;:9292,
    &quot;pubkey&quot;:&quot;4639e297633117888df17deed6b3860ff152e9e464690623b6b3d6ae4923ad62&quot;,
    &quot;sig&quot;:&quot;2fb7a6c956b66c3c189e2e9775483270ab95a82a7578d75390ce3e50a4d7b223cbce31402277c48d9f4565a02fbd933e676474eed81d69e32dce94d175406023&quot;,
    &quot;tags&quot;:[
        [&quot;p&quot;,&quot;3eea9e831fefdaa8df35187a204d82edb589a36b170955ac5ca6b88340befaa0&quot;],
        [&quot;p&quot;,&quot;f831caf722214748c72db4829986bd0cbb2bb8b3aeade1c959624a52a9629046&quot;],
        [&quot;e&quot;,&quot;e534d73109b98a8a2f2627634ab1d0195923dd638b6aa76a63eb7eefa3d59e32&quot;], // Proposal ID
        [&quot;e&quot;,&quot;9e0dfd2177ea9357f0c165ed134a86a3c07449676d8315e12d159932ff428e37&quot;] // Policy ID
    ]
}
</code></pre>
<h2 id="9094---signer"><a class="header" href="#9094---signer">9094 - Signer</a></h2>
<h3 id="example-9"><a class="header" href="#example-9">Example</a></h3>
<p>Unencrypted content:</p>
<pre><code class="language-json">{
    &quot;description&quot;:null,
    &quot;descriptor&quot;:&quot;descriptor&quot;,
    &quot;fingerprint&quot;:&quot;417a110f&quot;,
    &quot;name&quot;:&quot;Signer name&quot;,
    &quot;t&quot;:&quot;AirGap&quot;
}
</code></pre>
<p>Event:</p>
<pre><code class="language-json">{
    &quot;content&quot;:&quot;bVTA0YYf0+8CZXZtnBWMFu5YLyJR75YyRgAuiATQIvc2LEqiB9B5ARhypbtP+pGRXrhHGaPeZCzSunsP/sb5MXuXmsofAlzWeEAUcAaZC59z2hC97d2DSwYCQFE89MQTf9wrCPZGGAyfEMG9cnSeBuxldKKL5xOPCLfv4JqRSqdILI08h6leaxKTjZLJOLA+Pno7BZlsHazBuV7ZKwq6uGtsF3Nx2v3be+/210JnIrUFyOmCTqatkaLEHLHzekfTV86lJZTQ7YH7XE+TeQpen4H2ZlaJoeEB/JbR8PuONlVo1tjbWq8gdV0G/7kDs57LIzHW6pPsmyh1CNkokfp1Uw==?iv=UUAnvlWtfnHbj5bqDZomhA==&quot;,
    &quot;created_at&quot;:1688205807,
    &quot;id&quot;:&quot;fe1b6712daabae7157b4948d74c53a01f6186c4ecf0619ea147de85fbed8735a&quot;,
    &quot;kind&quot;:9294,
    &quot;pubkey&quot;:&quot;f831caf722214748c72db4829986bd0cbb2bb8b3aeade1c959624a52a9629046&quot;,
    &quot;sig&quot;:&quot;65783a7e0e1cff481cfc861413a2485ce3e9c461887c51e6258d9e00023a8c34058239f55f2156e88c6052e3df252bdfbc5bd132ebe6773968621ece5517af41&quot;,
    &quot;tags&quot;:[]
}
</code></pre>
<h2 id="9095---shared-signer"><a class="header" href="#9095---shared-signer">9095 - Shared signer</a></h2>
<h3 id="required-tags-5"><a class="header" href="#required-tags-5">Required tags</a></h3>
<ul>
<li><code>e</code>: event ID of the <code>signer</code></li>
<li><code>p</code>: public key of the user to you are sharing signer to</li>
</ul>
<h3 id="example-10"><a class="header" href="#example-10">Example</a></h3>
<p>Unencrypted content:</p>
<pre><code class="language-json">{
    &quot;descriptor&quot;:&quot;tr(...)&quot;,
    &quot;fingerprint&quot;:&quot;00000000&quot;
}
</code></pre>
<p>Event:</p>
<pre><code class="language-json">{
    &quot;content&quot;:&quot;LC3wv4bucBHIIQkvR9iNlQbSHlEIRqRnfPM0cDwxYr8NRL57Jq1K6kmUbGPXrviDgYlUiNxxeRYNKqd2OX4vhjojUuUQpSr7B01zSS1nCi7JlJU1BdlNcvwZSN/Qd6cW+fXfBTLebdBVRDAR9N681i0rf1kaRI5v3kcTK/Kgq8YFDun0C85nRjyt1GsfcrH297w9nF1+uG3MXtTXAbh3sDPuEWLFR8MS8OEdjntlgD3VGIiwG+xzFdwwkNosptATp0GEjBQhG3jcccGgG9kUhg==?iv=TwMC14xa7Ux9BK6zyu1Cpw==&quot;,
    &quot;created_at&quot;:1688207242,
    &quot;id&quot;:&quot;1220540b6c8f6d5179cafdae93e304a3cc4134a9d958f7c4094dc985347b5a8d&quot;,
    &quot;kind&quot;:9295,
    &quot;pubkey&quot;:&quot;f831caf722214748c72db4829986bd0cbb2bb8b3aeade1c959624a52a9629046&quot;,
    &quot;sig&quot;:&quot;e3df3184440dcbdb31f9dc13071e59375480f3f744b25586601d8f646edaf66e8f13699e46ae04683e6a6b26ffbf9a392f1cfee352d4cd13dba223650e63ba52&quot;,
    &quot;tags&quot;:[
        [&quot;e&quot;,&quot;fe1b6712daabae7157b4948d74c53a01f6186c4ecf0619ea147de85fbed8735a&quot;], // Signer ID
        [&quot;p&quot;,&quot;3eea9e831fefdaa8df35187a204d82edb589a36b170955ac5ca6b88340befaa0&quot;]
    ]
}
</code></pre>
<h2 id="32121---label"><a class="header" href="#32121---label">32121 - Label</a></h2>
<h3 id="required-tags-6"><a class="header" href="#required-tags-6">Required tags</a></h3>
<ul>
<li><code>e</code>: event ID of the <code>vault</code></li>
<li><code>d</code>: unique ID of the <code>label</code></li>
<li><code>p</code>: public keys of the users involved in the <code>vault</code></li>
</ul>
<h3 id="example-11"><a class="header" href="#example-11">Example</a></h3>
<p>Unencrypted content:</p>
<pre><code class="language-json">{
    &quot;data&quot;:{
        &quot;address&quot;:&quot;tb1p...&quot;
    },
    &quot;text&quot;:&quot;Label&quot;
}
</code></pre>
<p>Event:</p>
<pre><code class="language-json">{
    &quot;content&quot;:&quot;8pIsvOkUvh2necC9kQuRjDMRyDZPDzvigt/cy7RY+690KUwqT/IluT7+yezIO5i2EG9EyizVFGOn35unILaF3tiquGACLvFy39pSwdZCLdNWQcPWFFn/BPLBW/9j9RJy3UqBr9YHdPABDo4nsdd1Ww==?iv=hl9l3SiUiHss58o4oxi8Dg==&quot;,
    &quot;created_at&quot;:1694864773,
    &quot;id&quot;:&quot;1fd6cbd917c1e2ed2b0b3d18755460e49fbdb1ae46301e68c77747bbbf542244&quot;,
    &quot;kind&quot;:32121,
    &quot;pubkey&quot;:&quot;4639e297633117888df17deed6b3860ff152e9e464690623b6b3d6ae4923ad62&quot;,
    &quot;sig&quot;:&quot;d88ef25b04104a46d2568084fe268a10518fcb8c1c85999d462389f067ac79ccaec285b84cb2600fedfae04650fd12cdbe070f4b167ca7acd0bc86f4ecb83daa&quot;,
    &quot;tags&quot;:[
        [&quot;p&quot;,&quot;3eea9e831fefdaa8df35187a204d82edb589a36b170955ac5ca6b88340befaa0&quot;],
        [&quot;p&quot;,&quot;f831caf722214748c72db4829986bd0cbb2bb8b3aeade1c959624a52a9629046&quot;],
        [&quot;d&quot;,&quot;1f7db84fdf986cea2fa1d70f2120ad85&quot;], // Unique ID
        [&quot;e&quot;,&quot;9e0dfd2177ea9357f0c165ed134a86a3c07449676d8315e12d159932ff428e37&quot;] // Policy ID
    ]
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rust-sdk"><a class="header" href="#rust-sdk">Rust SDK</a></h1>
<p>This section will show you how to use the Rust SDK.</p>
<p>TODO: add UniFFI docs next to the Rust docs (use content tabs)</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installing-the-library"><a class="header" href="#installing-the-library">Installing the library</a></h1>
<p>Add the <code>smartvaults-sdk</code> dependency in your <code>Cargo.toml</code> file:</p>
<pre><code class="language-toml">[dependencies]
smartvaults-sdk = { git = &quot;https://github.com/smartvaults/smartvaults&quot;, tag = &quot;vX.X.X&quot; }
</code></pre>
<p>Note: you can specify a commit using <code>rev</code> instead of <code>tag</code>.</p>
<h2 id="examples"><a class="header" href="#examples">Examples</a></h2>
<p>Use a specific version:</p>
<pre><code class="language-toml">[dependencies]
smartvaults-sdk = { git = &quot;https://github.com/smartvaults/smartvaults&quot;, tag = &quot;v0.3.0&quot; }
</code></pre>
<p>Use a specific commit:</p>
<pre><code class="language-toml">[dependencies]
smartvaults-sdk = { git = &quot;https://github.com/smartvaults/smartvaults&quot;, rev = &quot;383c186cb1df3ab5906978d6b313aed86d2698b1&quot; }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="features"><a class="header" href="#features">Features</a></h1>
<p>The Rust SDK can be used both in <code>async/await</code> and <code>blocking</code> contexts.</p>
<p>By default, the SDK operate in <code>async</code> mode, so to use it in a blocking context, you have to specify the <code>blocking</code> feature:</p>
<pre><code class="language-toml">[dependencies]
smartvaults-sdk = { ..., features = [&quot;blocking&quot;] }
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="constructors"><a class="header" href="#constructors">Constructors</a></h1>
<p>Let's start by constructing the <code>SmartVaults</code> struct.</p>
<p>There are 3 possible constructors: <code>generate</code>, <code>restore</code> and <code>open</code>.
All these when constructed return a ready to use client.</p>
<h2 id="generate"><a class="header" href="#generate">Generate</a></h2>
<p>This constructor generate a random <a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki">BIP39</a> mnemonic and store
it in a local <a href="rust-sdk/./keychain/01-index.html">encrypted keychain</a>.</p>
<pre><pre class="playground"><code class="language-rust no_run">use smartvaults_sdk::prelude::*;

<span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = SmartVaults::generate(
    &quot;./your-base-path&quot;, // A local path where to store all the data
    &quot;account-name&quot;, // This will be used for the keychain file name
    || Ok(String::from(&quot;password&quot;)), // Keychain encryption password
    || Ok(String::from(&quot;password&quot;)), // Confirmation of the above password
    WordCount::W24, // Number of mnemonic words (possible values are: 12, 18 or 24)
    || Ok(None), // Optional passphrase that will be stored in the keychain
    Network::Testnet, // The bitcoin network to use
)
.await?;
<span class="boring">}</span></code></pre></pre>
<h2 id="restore"><a class="header" href="#restore">Restore</a></h2>
<p>This constructor restore a <a href="https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki">BIP39</a> mnemonic and store
it in a local <a href="rust-sdk/./keychain/01-index.html">encrypted keychain</a>.</p>
<pre><pre class="playground"><code class="language-rust no_run">use smartvaults_sdk::prelude::*;

<span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = SmartVaults::restore(
    &quot;./your-base-path&quot;, // A local path where to store all the data
    &quot;account-name&quot;, // This will be used for the keychain file name
    || Ok(String::from(&quot;password&quot;)), // Keychain encryption password
    || Ok(String::from(&quot;password&quot;)), // Confirmation of the above password
    || Ok(Mnemonic::from_str(&quot;your menmonic&quot;).unwrap()), // A BIP39 mnemonic
    || Ok(Some(String::from(&quot;my-optional-passphrase&quot;))), // Optional passphrase that will be stored in the keychain
    Network::Testnet, // The bitcoin network to use
)
.await?;
<span class="boring">}</span></code></pre></pre>
<h2 id="open"><a class="header" href="#open">Open</a></h2>
<p>This constructor open an <strong>already existing</strong> keychain.</p>
<pre><pre class="playground"><code class="language-rust no_run">use smartvaults_sdk::prelude::*;

<span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = SmartVaults::open(
    &quot;./your-base-path&quot;,
    &quot;account-name&quot;,
    || Ok(String::from(&quot;password&quot;)),
    Network::Testnet,
)
.await?;
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configs--relays"><a class="header" href="#configs--relays">Configs &amp; Relays</a></h1>
<p>Once the client is constructed, you can start editing the default configs and relays.</p>
<p>Note: both the configs and relays are persistent, so you <strong>not</strong> need to edit them every time.</p>
<h2 id="view-and-edit-configs"><a class="header" href="#view-and-edit-configs">View and edit configs</a></h2>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

// Get the current configs
let config = client.config();

// View the current configs
println!(&quot;Current electrum endpoint: {}&quot;, config.electrum_endpoint().await?);
println!(&quot;Current proxy: {}&quot;, config.proxy().await.ok());
println!(&quot;Current block explorer: {}&quot;, config.block_explorer().await?);

// Edit the electrum endpoint
config.set_electrum_endpoint(Some(&quot;tcp://127.0.0.1:50001&quot;)).await;

// Edit the block explorer url
let url = Url::parse(&quot;http://myblockexplorer.local&quot;)?;
config.set_block_explorer(Some(url)).await;

// Save the configs in the persistent file
config.save().await?;
<span class="boring">}</span></code></pre></pre>
<h2 id="view-relays"><a class="header" href="#view-relays">View relays</a></h2>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

for (relay_url, relay) in client.relays().await.into_iter() {
    let stats = relay.stats();
    println!(&quot;Url: {relay_url}&quot;);
    println!(&quot;Status: {}&quot;, relay.status().await);
    println!(&quot;Attempts: {}&quot;, stats.attempts());
    println!(&quot;Success: {}&quot;, stats.success());
    println!(&quot;Bytes sent: {}&quot;, stats.bytes_sent());
    println!(&quot;Bytes received: {}&quot;, stats.bytes_received());
    if let Some(latency) = stats.latency().await {
        println!(&quot;Latency: {} ms&quot;, latency.as_millis());
    }
}
<span class="boring">}</span></code></pre></pre>
<h2 id="edit-relays"><a class="header" href="#edit-relays">Edit relays</a></h2>
<pre><pre class="playground"><code class="language-rust no_run">use std::net::{Ipv4Addr, SocketAddr, SocketAddrV4};
<span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

// Add a relay (without proxy)
client.add_relay(&quot;wss://you.relay.com&quot;, None).await?;

// Add a relay (with proxy)
let proxy = Some(SocketAddr::V4(SocketAddrV4::new(Ipv4Addr::LOCALHOST, 9050)));
client.add_relay(&quot;wss://you.relay2.com&quot;, Some(proxy)).await?;

// Remove a relay
client.remove_relay(&quot;wss://you.relay.com&quot;).await?;
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="profile--contacts"><a class="header" href="#profile--contacts">Profile &amp; Contacts</a></h1>
<h2 id="profile"><a class="header" href="#profile">Profile</a></h2>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

// Get your profile (public key and metadata)
let profile: User = client.get_profile().await?;
println!(&quot;My public key: {}&quot;, profile.public_key());
println!(&quot;My name: {}&quot;, profile.name());
println!(&quot;My metadata: {:#?}&quot;, profile.metadata());

// Edit metadata
let metadata = profile.metadata().name(&quot;myname&quot;).display_name(&quot;My Name&quot;).nip05(&quot;myname@example.com&quot;);
client.set_metadata(metadata).await?;
<span class="boring">}</span></code></pre></pre>
<h2 id="addremove-contacts"><a class="header" href="#addremove-contacts">Add/Remove contacts</a></h2>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

// Public key from hex
let public_key = XOnlyPublicKey::from_str(&quot;ea527e059759d368a55253270454e58e9d6e4fe2e98d302d6e01821fa973259d&quot;)?;
// Public key from bech32
let public_key = XOnlyPublicKey::from_bech32(&quot;npub1aff8upvht8fk3f2j2vnsg48936wkunlzaxxnqttwqxppl2tnykwsahwngp&quot;)?;

// Add a contact
// This method will automatically request metadata of the contact
client.add_contact(public_key).await?;

// Remove a contact
let another_public_key: XOnlyPublicKey = ...;
client.remove_contact(another_public_key).await?;

// Get contact list
let list: Vec&lt;User&gt; = client.get_contacts().await?;
<span class="boring">}</span></code></pre></pre>
<h2 id="get-metadata-of-a-generic-public-key"><a class="header" href="#get-metadata-of-a-generic-public-key">Get metadata of a generic public key</a></h2>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

let public_key: XOnlyPublicKey = ...;
// This method check if metadata for a public key exists in local database.
// If not exists, will return an empty `Metadata` struct and will request it to relays.
let metadata: Metadata = client.get_public_key_metadata(public_key).await?;
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="signers"><a class="header" href="#signers">Signers</a></h1>
<p>Signers are descriptors that you can share with contacts (or with other users) to simplify the
process of policies creation.</p>
<h2 id="the-smartvaults-signer"><a class="header" href="#the-smartvaults-signer">The SmartVaults signer</a></h2>
<p>The <code>SmartVaults</code> signer it's derived from your local seed.
It's use the following derivation path: <code>m/86'/&lt;coin&gt;'/784923'</code> (the <code>coin</code> depends on the selected <code>network</code>)</p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

// Save the SmartVaults signer (if not exists)
client.save_smartvaults_signer().await?;
<span class="boring">}</span></code></pre></pre>
<h2 id="external-signers"><a class="header" href="#external-signers">External signers</a></h2>
<p>You can save external signers (like <code>AirGap</code> devices).</p>
<pre><pre class="playground"><code class="language-rust no_run">use std::str::FromStr;

<span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

let fingerprint = Fingerprint::from_str(&quot;7356e457&quot;)?;
let descriptor: Descriptor&lt;DescriptorPublicKey&gt; = Descriptor::from_str(&quot;[7356e457/86'/1'/784923']tpubDCvLwbJPseNux9EtPbrbA2tgDayzptK4HNkky14Cw6msjHuqyZCE88miedZD86TZUb29Rof3sgtREU4wtzofte7QDSWDiw8ZU6ZYHmAxY9d/0/*&quot;)?;
let signer = Signer::airgap(&quot;Coldcard&quot;, &quot;Description&quot;, fingerprint, descriptor)?;
client.save_signer(signer).await?;
<span class="boring">}</span></code></pre></pre>
<p>Note: <strong>only</strong> <code>taproot</code> descriptors are supported</p>
<h2 id="share-a-signer"><a class="header" href="#share-a-signer">Share a signer</a></h2>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

// Get my signers
let signers: Vec&lt;GetSigner&gt; = client.get_signers().await?;

// Get the first signer
let signer_id = signers.first().unwrap().signer_id;

// Public key of the user to share the signer
let public_key: XOnlyPublicKey = ...;

// Share
client.share_signer(signer_id, public_key).await?;
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="policies"><a class="header" href="#policies">Policies</a></h1>
<p>In this section we'll see how to <code>create</code> a policy from a <code>template</code> or from a <code>custom descriptor</code> and how to <code>fund</code> it.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="templates"><a class="header" href="#templates">Templates</a></h1>
<p>This library provide some <code>templates</code> to simplify the policies creation. 
Currently the following templates are available:</p>
<ul>
<li>Multisig (M of N)</li>
<li>Social recovery: 1 spending key and N others with a <code>relative</code> timelock (funds can be spent after a sequence of N blocks)</li>
<li>Inheritance: 1 spending key and N others with an <code>absolute</code> timelock (funds can be spent after the block or timestamp X)</li>
<li>Hold: 1 spending key and a <code>relative</code> timelock</li>
</ul>
<h2 id="save-a-template"><a class="header" href="#save-a-template">Save a template</a></h2>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

let public_keys = vec![...]; // Nostr public keys of users involved in the policy
let template = ...; // See below examples
client
    .save_policy_from_template(
        &quot;My Policy&quot;, // Name of the policy
        &quot;Policy created from a template&quot;, // Description
        template,
        public_keys,
    )
    .await?;
<span class="boring">}</span></code></pre></pre>
<h3 id="examples-1"><a class="header" href="#examples-1">Examples</a></h3>
<p>To simplify the code below, I define all the descriptors used here:</p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use std::str::FromStr;
use smartvaults_sdk::core::miniscript::DescriptorPublicKey;

let key1 = DescriptorPublicKey::from_str(&quot;[7356e457/86'/1'/784923']tpubDCvLwbJPseNux9EtPbrbA2tgDayzptK4HNkky14Cw6msjHuqyZCE88miedZD86TZUb29Rof3sgtREU4wtzofte7QDSWDiw8ZU6ZYHmAxY9d/0/*&quot;).unwrap();
let key2 = DescriptorPublicKey::from_str(&quot;[4eb5d5a1/86'/1'/784923']tpubDCLskGdzStPPo1auRQygJUfbmLMwujWr7fmekdUMD7gqSpwEcRso4CfiP5GkRqfXFYkfqTujyvuehb7inymMhBJFdbJqFyHsHVRuwLKCSe9/0/*&quot;).unwrap();
let key3 = DescriptorPublicKey::from_str(&quot;[f3ab64d8/86'/1'/784923']tpubDCh4uyVDVretfgTNkazUarV9ESTh7DJy8yvMSuWn5PQFbTDEsJwHGSBvTrNF92kw3x5ZLFXw91gN5LYtuSCbr1Vo6mzQmD49sF2vGpReZp2/0/*&quot;).unwrap();
<span class="boring">}</span></code></pre></pre>
<h2 id="multisig-1-of-2"><a class="header" href="#multisig-1-of-2">Multisig 1 of 2</a></h2>
<p>Using the <code>key1</code> and <code>key2</code> to create a multisig <code>1 of 2</code></p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use std::str::FromStr;
</span><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let template = PolicyTemplate::multisig(1, vec![key1, key2]);
<span class="boring">}</span></code></pre></pre>
<h2 id="social-recovery"><a class="header" href="#social-recovery">Social recovery</a></h2>
<p>Using <code>key1</code> as spending key and <code>key2</code> and <code>key3</code> as recovery keys with a <code>relative</code> timelock of <code>6 blocks</code></p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let older = Sequence(6); // Relative timelock of 6 blocks
let recovery = RecoveryTemplate::social_recovery(2, vec![key2, key3], older);
let template = PolicyTemplate::recovery(key1, recovery);
<span class="boring">}</span></code></pre></pre>
<h2 id="inheritance"><a class="header" href="#inheritance">Inheritance</a></h2>
<p>Using <code>key1</code> as spending key and <code>key2</code> and <code>key3</code> as recovery with an <code>absolute</code> timelock set at block <code>840000</code></p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let after = AbsoluteLockTime::from_height(840_000)?; // Absolute timelock (funds can be spent after block 840000)
let recovery = RecoveryTemplate::inheritance(2, vec![key2, key3], after);
let template = PolicyTemplate::recovery(key1, recovery);
<span class="boring">}</span></code></pre></pre>
<h2 id="hold"><a class="header" href="#hold">Hold</a></h2>
<p>Using a <code>single key</code> with a <code>relative</code> timelock</p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let older = Sequence(10_000);
let template = PolicyTemplate::hold(key1, older);
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="custom-policies"><a class="header" href="#custom-policies">Custom policies</a></h1>
<p>If you need to save more complex policies that are not included in <a href="rust-sdk/08-policies/./02-templates.html">templates</a>, you can use the <code>save_policy</code> method:</p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

let public_keys = vec![...]; // Nostr public keys of users involved in the policy
client
    .save_policy(
        &quot;My custom policy&quot;, // Name of the policy
        &quot;Custom policy&quot;, // Description
        &quot;...&quot;, // Miniscript policy or already compiled descriptor
        public_keys,
    )
    .await?;
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="funding"><a class="header" href="#funding">Funding</a></h1>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

// Get first policy
let policy = client.get_policies().await?.first().unwrap();

// OR

// Get a specific policy by ID
let policy = client.get_policy_by_id(policy_id).await?;

// Get a new address
let GetAddress { address, .. } = client.get_address(policy.policy_id, AddressIndex::New).await?;
println!(&quot;Address: {}&quot;, address.assume_checked());
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="proposals"><a class="header" href="#proposals">Proposals</a></h1>
<p>In this section we'll see how to create a <code>spending</code> proposal and how to <code>approve</code> and <code>finalize</code> it. </p>
<h2 id="spend"><a class="header" href="#spend">Spend</a></h2>
<p>Create a new <code>spending</code> proposal</p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

let policy_id: EventId = ...; // Get from policies list or pass a specific event ID

// Create a new proposal
let proposal: Proposal = client
    .spend(
        policy_id,
        Address::from_str(&quot;mohjSavDdQYHRYXcS3uS6ttaHP8amyvX78&quot;)?, // Dastination address
        Amount::Custom(10_934), // Use `Amount::Max` to send all funds
        &quot;Back to the faucet&quot;, // Description
        FeeRate::Priority(Priority::Medium), // Use `FeeRate::Rate(1.0)`` to specify the sat/vByte
        None, // Specify the UTXOs to use (optional)
        None, // Specify the policy path to use (needed only if exists a timelock in the policy descriptor)
        false, // Allow usage of UTXOs frozen by others proposals
    )
    .await?;
println!(&quot;New proposal: {proposal:#?}&quot;);
<span class="boring">}</span></code></pre></pre>
<h2 id="approvals"><a class="header" href="#approvals">Approvals</a></h2>
<p>Currently you can approve a proposal with the <code>seed</code> stored in the <a href="rust-sdk/./keychain/01-index.html">keychain</a> or use an <code>AirGap</code> signer and import
the signed PSBT.</p>
<h3 id="approve-with-the-seed"><a class="header" href="#approve-with-the-seed">Approve with the seed</a></h3>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

let proposal_id: EventId = ...; // Id of a proposal
// Ex. let proposal_id: EventId = proposal.proposal_id;

// Approve a proposal with the stored seed
client.approve(proposal_id).await?;
<span class="boring">}</span></code></pre></pre>
<h3 id="approve-with-a-signed-psbt-airgap-signer"><a class="header" href="#approve-with-a-signed-psbt-airgap-signer">Approve with a signed PSBT (AirGap signer)</a></h3>
<pre><pre class="playground"><code class="language-rust no_run">use std::str::FromStr;
use smartvaults_sdk::core::bitcoin::psbt::PartiallySignedTransaction;

<span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

let proposal_id: EventId = ...; // Id of a proposal
// Ex. let proposal_id: EventId = proposal.proposal_id;

// Approve a proposal with a PSBT
let signed_psbt = PartiallySignedTransaction::from_str(&quot;base64-psbt&quot;)?;
client.approve_with_signed_psbt(proposal_id, signed_psbt).await?;
<span class="boring">}</span></code></pre></pre>
<h2 id="finalization"><a class="header" href="#finalization">Finalization</a></h2>
<p>When the proposal is signed, you can finalize it.</p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

let proposal_id: EventId = ...;
let proposal: GetProposal = client.get_proposal_by_id(proposal_id).await?;

// Check if proposal is signed
if proposal.signed {
    // Finalize the proposal and broadcast the TX
    client.finalize(proposal_id).await?;
} else {
    println!(&quot;This proposal is not fully signed yet!&quot;);
}
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="connect"><a class="header" href="#connect">Connect</a></h1>
<p>In this section we'll see how to connect to a Web App using the <a href="https://github.com/nostr-protocol/nips/blob/master/46.md">NIP46</a> (Nostr Connect).</p>
<h2 id="initialize-a-new-session"><a class="header" href="#initialize-a-new-session">Initialize a new session</a></h2>
<p>To initialize a new session, you'll need a nostr connect URI (it's provided from the app you want connect to).</p>
<pre><pre class="playground"><code class="language-rust no_run">use std::str::FromStr;

<span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

// Parse URI
let uri = NostrConnectURI::forom_str(&quot;nostrconnect://f0d056e4bc98d52d53df73fd2f3dac287b1f5f2d868414172759d663987a95e3?metadata=%7B%22name%22%3A%22Smart%20Vaults%22%2C%22description%22%3A%22Bitcoin%20multi-custody%20signature%20orchestration%22%2C%22url%22%3A%22https%3A%2F%2Fsmartvaults.app%22%2C%22icons%22%3A%5B%22https%3A%2F%2Fsmartvaults.app%2Ffavicon.ico%22%5D%7D&amp;relay=wss%3A%2F%2Ftest.relay.report&quot;)?;

// Initialize session
client.new_nostr_connect_session(uri).await?;
<span class="boring">}</span></code></pre></pre>
<h2 id="get-approve-and-reject-requests"><a class="header" href="#get-approve-and-reject-requests">Get, approve and reject requests</a></h2>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

// Get pending requests
let approved: bool = false;
let requests: Vec&lt;NostrConnectRequest&gt; = client.get_nostr_connect_requests(approved).await?;

let first_req: NostrConnectRequest = requests.first().unwrap();
let second_req: NostrConnectRequest = requests.get(1).unwrap();

// Approve a request
client.approve_nostr_connect_request(first_req.event_id).await?;

// Reject a request
client.reject_nostr_connect_request(second_req.event_id).await?;
<span class="boring">}</span></code></pre></pre>
<h2 id="disconnect-from-a-session"><a class="header" href="#disconnect-from-a-session">Disconnect from a session</a></h2>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

// Get current sessions
let sessions: Vec&lt;(NostrConnectURI, Timestamp)&gt; = client.get_nostr_connect_sessions().await?;

// Disconnect from all sessions
for (uri, _timestamp) in sessions.into_iter() {
    // Disconnect session from app public key
    client.disconnect_nostr_connect_session(uri.public_key).await?;
}
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="keychain"><a class="header" href="#keychain">Keychain</a></h1>
<p>This section will show you how to manage the <code>keychain</code>.</p>
<h2 id="definition"><a class="header" href="#definition">Definition</a></h2>
<p>Keychain means a <code>seed</code> plus an optional list of <code>passphrases</code>.</p>
<h2 id="store"><a class="header" href="#store">Store</a></h2>
<p>The <code>keychian</code> it's stored in a file called <code>keechain</code>. It's encrypted using AES-256 in CBC mode and XChaCha20Poly1305: <code>XChaCha20Poly1305(AES256CBC(keychain))</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="change-password"><a class="header" href="#change-password">Change password</a></h1>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

client.change_password(
    || Ok(String::from(&quot;current-password&quot;)), // Current password
    || Ok(String::from(&quot;new-password&quot;)), // New password
    || Ok(String::from(&quot;new-password&quot;)), // Confirmation of new password
)?;
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="secrets"><a class="header" href="#secrets">Secrets</a></h1>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

let secp = Secp256k1::new();

let network: Network = client.network();
let keychain: Keychain = client.keychain();
let secrets: Secrets = keychain.secrets(network, &amp;secp)?;

println!(&quot;Entropy: {}&quot;, secrets.entropy);
println!(&quot;Mnemonic: {}&quot;, secrets.mnemonic);
if let Some(passphrase) = &amp;secrets.passphrase {
    println!(&quot;Passphrase: {}&quot;, passphrase);
}
println!(&quot;Seed (hex): {}&quot;, secrets.seed_hex);
println!(&quot;Root Key (BIP32): {}&quot;, secrets.root_key);
println!(&quot;Fingerprint: {}&quot;, secrets.fingerprint);
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="wipe"><a class="header" href="#wipe">Wipe</a></h1>
<p>Delete the <code>keychain</code></p>
<pre><pre class="playground"><code class="language-rust no_run"><span class="boring">use smartvaults_sdk::prelude::*;
</span><span class="boring">
</span><span class="boring">#[tokio::main]
</span><span class="boring">async fn main() {
</span>let client = ...; // The client that you before constructed

// Delete the keychain
client.wipe(&quot;your-password&quot;)?;
<span class="boring">}</span></code></pre></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting started</a></h1>
<h2 id="install-dependencies"><a class="header" href="#install-dependencies">Install dependencies</a></h2>
<pre><code class="language-shell">npm install @smontero/smartvaults-js-client @smontero/smartvaults-wasm @smontero/nostr-ual --save
</code></pre>
<h2 id="import-modules"><a class="header" href="#import-modules">Import modules</a></h2>
<pre><code class="language-javascript">import { NostrClient, SmartVaults, Contact, Keys } from '@smontero/smartvaults-js-client';
import { DirectPrivateKeyAuthenticator } from '@smontero/nostr-ual'
import {
  Wallet,
  miniscript_to_descriptor as miniScriptToDescriptor,
  can_finalize_psbt as canFinalizePsbt,
  get_trx_id as getTrxIdWasm,
  get_fee as getFeeWasm,
  MiniscriptBuilder,
  get_psbt_utxos as getPsbtUtxos,
  descriptor_to_miniscript as descriptorToMiniscript
} from '@smontero/smartvaults-wasm'
</code></pre>
<h2 id="initializing-smartvaults"><a class="header" href="#initializing-smartvaults">Initializing <code>SmartVaults</code></a></h2>
<h3 id="parameters-for-initialization"><a class="header" href="#parameters-for-initialization">Parameters for Initialization</a></h3>
<ol>
<li><code>authenticator</code>: An instance of an Authenticator</li>
<li><code>bitcoinUtil</code>: Utility functions related to Bitcoin transactions</li>
<li><code>nostrClient</code>: An instance of NostrClient for interacting with Nostr relays</li>
</ol>
<pre><code class="language-javascript">// Define the authenticator
const myKeys = new Keys()
const authenticator = new DirectPrivateKeyAuthenticator(myKeys.privateKey)

// Define the bitcoin utility functions
const ENDPONIT = 'https://mempool.space/testnet/api'
const NETWORK = 'testnet'
const STOP_GAP = 20 // Stop searching addreses for transactions after this number of consecutive addresses with no transactions is found
const bitcoinUtil = {
        walletSyncTimeGap: 3, // Minutes that have to pass after the last sync, to require another sync when performing an operation
        toDescriptor: miniScriptToDescriptor,
        createWallet: (descriptor) =&gt; {
          return new Wallet(
            descriptor,
            ENDPONIT,
            NETWORK,
            STOP_GAP
          )
        },
        canFinalizePsbt: (psbts) =&gt; canFinalizePsbt(psbts),
        getTrxId: (trx) =&gt; getTrxIdWasm(trx),
        getFee: (psbt) =&gt; getFeeWasm(psbt),
        getPsbtUtxos: (psbt) =&gt; getPsbtUtxos(psbt),
        toMiniscript: (descriptor) =&gt; descriptorToMiniscript(descriptor)
}

// Define the Nostr client
const nostrClient = new NostrClient(['wss://test.relay.report'])

// Initialize SmartVaults
const smartVaults = new SmartVaults ({authenticator, bitcoinUtil, nostrClient})
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="set-profile-and-contacts"><a class="header" href="#set-profile-and-contacts">Set profile and Contacts</a></h1>
<p>In this section we show how to manage user profiles and contacts.</p>
<h2 id="table-of-contents"><a class="header" href="#table-of-contents">Table of Contents</a></h2>
<ol>
<li><strong>Setting up Metadata and User Profiles</strong></li>
<li><strong>Retrieving the User Profile</strong></li>
<li><strong>Creating a New Contact</strong></li>
<li><strong>Adding or Updating a Contact</strong></li>
<li><strong>Fetching Contacts</strong></li>
<li><strong>Fetching Contacts with Metadata</strong></li>
<li><strong>Fetching Recommended Contacts</strong></li>
<li><strong>Removing a Contact</strong></li>
</ol>
<hr />
<h3 id="setting-up-metadata-and-user-profiles"><a class="header" href="#setting-up-metadata-and-user-profiles">Setting up Metadata and User Profiles</a></h3>
<p>To set up a user profile, you need to use the <code>setProfile</code> method. Create a metadata object to include the details you wish to set in the profile.</p>
<pre><code class="language-javascript">const metadata = { name: 'Bob', about: 'Learning about Smart Vaults!' };
await smartVaults.setProfile(metadata);
</code></pre>
<hr />
<h3 id="retrieving-the-user-profile"><a class="header" href="#retrieving-the-user-profile">Retrieving the User Profile</a></h3>
<p>To fetch a profile, use the <code>getProfile</code> method.</p>
<pre><code class="language-javascript">const myPublicKey = authenticator.getPublicKey();
const myProfile = await smartVaults.getProfile(myPublicKey);
</code></pre>
<hr />
<h3 id="creating-a-new-contact"><a class="header" href="#creating-a-new-contact">Creating a New Contact</a></h3>
<p>To create a new contact, let's first generate a new set of Keys.</p>
<pre><code class="language-javascript">const contactKeys = new Keys();
const contactAuthenticator = new DirectPrivateKeyAuthenticator(contactKeys.privateKey);
const contactPubKey = contactAuthenticator.getPublicKey();
</code></pre>
<hr />
<h3 id="creating-and-adding-a-contact"><a class="header" href="#creating-and-adding-a-contact">Creating and adding a contact</a></h3>
<p>The <code>upsertContacts</code> method allows you add a new contact.</p>
<pre><code class="language-javascript">const contact = new Contact({ publicKey: contactPubKey });
await smartVaults.upsertContacts(contact);
</code></pre>
<hr />
<h3 id="fetching-contacts"><a class="header" href="#fetching-contacts">Fetching Contacts</a></h3>
<p>You can fetch your existing contacts using the <code>getContacts</code> method.</p>
<pre><code class="language-javascript">const contacts = await smartVaults.getContacts();
</code></pre>
<hr />
<h3 id="fetching-contacts-along-with-their-metadata"><a class="header" href="#fetching-contacts-along-with-their-metadata">Fetching Contacts along with their metadata</a></h3>
<p>To fetch contacts along with their profile metadata, you can use the <code>getContactProfiles</code> method.</p>
<pre><code class="language-javascript">const contactsProfiles = await smartVaults.getContactProfiles();
</code></pre>
<h3 id="fetching-recommended-contacts"><a class="header" href="#fetching-recommended-contacts">Fetching Recommended Contacts</a></h3>
<p>When 'user A' adds 'user B' as a contact, 'user A' is automatically added as a recommended contact for 'user B'. To fetch recommended contacts, use the <code>getRecommendedContacts</code> method.</p>
<pre><code class="language-javascript">const recommendedContacts = await smartVaults.getRecommendedContacts();
</code></pre>
<h3 id="removing-a-contact"><a class="header" href="#removing-a-contact">Removing a Contact</a></h3>
<p>To remove a contact, use the <code>removeContacts</code> method.</p>
<pre><code class="language-javascript">await smartVaults.removeContacts(contactPubKey);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="signers-1"><a class="header" href="#signers-1">Signers</a></h1>
<p>This guide walks you through the process of fetching your owned signers and sharing them with your contacts.</p>
<h2 id="table-of-contents-1"><a class="header" href="#table-of-contents-1">Table of Contents</a></h2>
<ol>
<li><strong>Fetching Owned Signers</strong></li>
<li><strong>Sharing an Owned Signer with a Contact</strong></li>
</ol>
<hr />
<h3 id="fetching-owned-signers"><a class="header" href="#fetching-owned-signers">Fetching Owned Signers</a></h3>
<p>To get the list of signers that you own, you can use the <code>getOwnedSigners</code> method.</p>
<pre><code class="language-javascript">const mySigners = await smartVaults.getOwnedSigners();
const mySigner = mySigners[0]; // For this example, we are assuming that you have at least one signer
</code></pre>
<hr />
<h3 id="sharing-an-owned-signer-with-a-contact"><a class="header" href="#sharing-an-owned-signer-with-a-contact">Sharing an Owned Signer with a Contact</a></h3>
<p>To share a signer with a contact, use the <code>saveSharedSigner</code> method. The method takes two parameters: the <code>ownedSigner</code> you wish to share and the public keys of the contacts (<code>pubKeys</code>).</p>
<pre><code class="language-javascript">const pubKeys = [contactPubKey]; // Replace with the actual public keys of the contacts you wish to share the signer with
const sharedSigners = await smartVaults.saveSharedSigner(mySigner, pubKeys);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="vaults"><a class="header" href="#vaults">Vaults</a></h1>
<p>There cannot be Smart Vaults without Vaults. In this section, we will learn how to create and manage vaults. We start with some definitions.</p>
<ol>
<li><strong>Vault</strong> is a Bitcoin Wallet.</li>
<li><strong>Policy</strong> is a set of rules that define how a vault can be managed.</li>
<li><strong>Vault Template</strong> is Vault with a predefined Policy.</li>
</ol>
<p>While it is true that a Policy is not exactly the same as a descriptor, we define the <code>Policy event</code> as a Nostr event with kind <code>9289</code> that (in its encryped content) contains a descriptor.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-a-vault"><a class="header" href="#creating-a-vault">Creating a Vault</a></h1>
<p>In this example, we will create a 2-of-2 multisig vault, but as you will see, the process is similar for other types of vaults.</p>
<h3 id="fetching-the-signers-key"><a class="header" href="#fetching-the-signers-key">Fetching the Signer's Key</a></h3>
<p>To create a vault we need keys, once you have fetched your signers, get the key for the signer you wish to use.</p>
<pre><code class="language-javascript">const mySignerKey = mySigner.key;
</code></pre>
<hr />
<h3 id="getting-the-co-signers-key"><a class="header" href="#getting-the-co-signers-key">Getting the Co-Signer's Key</a></h3>
<p>Retrieve the key of a co-signer to include in the multisig vault.</p>
<pre><code class="language-javascript">const coSigner = await smartVaults.getSharedSigners();
const coSignerKey = coSigner[0].key;
</code></pre>
<hr />
<h3 id="setting-the-threshold-and-creating-miniscript"><a class="header" href="#setting-the-threshold-and-creating-miniscript">Setting the Threshold and Creating Miniscript</a></h3>
<p>Create a miniscript that specifies the threshold and keys for the 2-of-2 multisig.</p>
<pre><code class="language-javascript">const threshold = 2;
const keys = [mySignerKey, coSignerKey];
const miniscript = MiniscriptBuilder.multisig({threshold, keys});
</code></pre>
<hr />
<h3 id="defining-additional-parameters"><a class="header" href="#defining-additional-parameters">Defining Additional Parameters</a></h3>
<p>Define other necessary parameters, like the name and description of the vault, and the public keys of vault participants.</p>
<pre><code class="language-javascript">const name = 'My First Vault';
const description = &quot;2 of 2 Multisig&quot;;
const nostrPublicKeys = [myPublicKey, contactPubKey];
</code></pre>
<hr />
<h3 id="creating-the-vault"><a class="header" href="#creating-the-vault">Creating the Vault</a></h3>
<p>Finally, create the vault by invoking the <code>savePolicy</code> method.</p>
<pre><code class="language-javascript">await smartVaults.savePolicy({ name, description, miniscript, nostrPublicKeys });
</code></pre>
<p>Notice that the only assumption the <code>savePolicy</code> methods makes about the miniscript is that it is a valid miniscript. This means that you can use any miniscript you want, the Smart Vaults Web app offers a few templates to make it easier to create common types of vaults, but also allows you to create custom vaults.</p>
<hr />
<h3 id="basic-fetching-of-vaults"><a class="header" href="#basic-fetching-of-vaults">Basic Fetching of Vaults</a></h3>
<p>To fetch vaults without any specific pagination, you can simply call the <code>getPolicies</code> method without any arguments.</p>
<pre><code class="language-javascript">const policies = await smartVaults.getPolicies();
</code></pre>
<p>This will return an array of <code>PublishedPolicy</code> objects.</p>
<hr />
<h3 id="deleting-a-vault"><a class="header" href="#deleting-a-vault">Deleting a Vault</a></h3>
<p>To delete a vault, you can use the <code>deletePolicy</code> method.</p>
<pre><code class="language-javascript">await smartVaults.deletePolicies(policyId);
</code></pre>
<p>We will explore the vault methods in more detail in the next section.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-proposals"><a class="header" href="#creating-proposals">Creating Proposals</a></h1>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The <code>spend</code> method is used to create a spending proposal, first, let's look at the method definition.</p>
<h2 id="method-signature"><a class="header" href="#method-signature">Method Signature</a></h2>
<pre><code class="language-typescript">spend(payload: SpendProposalPayload): Promise&lt;PublishedSpendingProposal&gt;
</code></pre>
<h3 id="parameters"><a class="header" href="#parameters">Parameters</a></h3>
<h4 id="payload-spendproposalpayload"><a class="header" href="#payload-spendproposalpayload"><code>payload: SpendProposalPayload</code></a></h4>
<p>The payload for the spending proposal.</p>
<ul>
<li><code>policy</code>: PublishedPolicy object.</li>
<li><code>to_address</code>: The recipient's address.</li>
<li><code>description</code>: Description of the proposal.</li>
<li><code>amountDescriptor</code>: Amount to be spent.</li>
<li><code>feeRatePriority</code>: Fee rate priority (e.g., 'low', 'medium', 'high').</li>
<li><code>policyPath</code>: Policy path.</li>
<li><code>utxos</code>: List of unspent transaction outputs (UTXOs) to be used. (Optional)</li>
<li><code>useFrozenUtxos</code>: Flag to specify whether frozen UTXOs can be used. (Optional)</li>
</ul>
<h3 id="returns"><a class="header" href="#returns">Returns</a></h3>
<pre><code class="language-typescript">Promise&lt;PublishedSpendingProposal&gt;
</code></pre>
<p>A Promise that resolves to a <code>PublishedSpendingProposal</code> object representing the published spending proposal.</p>
<h2 id="errors"><a class="header" href="#errors">Errors</a></h2>
<p>The method may throw various errors under certain conditions:</p>
<ul>
<li><strong>Invalid UTXOs</strong>: If the provided UTXOs are invalid.</li>
<li><strong>Frozen UTXOs Without Flag</strong>: If frozen UTXOs are provided but <code>useFrozenUtxos</code> is not set to <code>true</code>.</li>
<li><strong>Transaction Building Error</strong>: If an error occurs while building the transaction.</li>
<li><strong>Publishing Error</strong>: If an error occurs while publishing the proposal.</li>
</ul>
<h2 id="example-usage"><a class="header" href="#example-usage">Example Usage</a></h2>
<p>Here's an example code snippet that demonstrates how to use the <code>spend</code> method to create a spending proposal:</p>
<pre><code class="language-javascript">const payload = {
  policy: somePublishedPolicyObject,
  to_address: &quot;abc123&quot;,
  description: &quot;A spending proposal&quot;,
  amountDescriptor: 10,
  feeRatePriority: 'high',
  policyPath: new Map([['nodeId',[0,1,2]]]) // Optional but needed if the policy descriptor has more than one path,
  utxos: [&quot;utxo1&quot;, &quot;utxo2&quot;], // Optional
  useFrozenUtxos: false // Optional
};

const spendingProposal = await spend(payload);

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="creating-proposals-1"><a class="header" href="#creating-proposals-1">Creating Proposals</a></h1>
<h2 id="overview-1"><a class="header" href="#overview-1">Overview</a></h2>
<p>The <code>spend</code> method is used to create a spending proposal, first, let's look at the method definition.</p>
<h2 id="method-signature-1"><a class="header" href="#method-signature-1">Method Signature</a></h2>
<pre><code class="language-typescript">spend(payload: SpendProposalPayload): Promise&lt;PublishedSpendingProposal&gt;
</code></pre>
<h3 id="parameters-1"><a class="header" href="#parameters-1">Parameters</a></h3>
<h4 id="payload-spendproposalpayload-1"><a class="header" href="#payload-spendproposalpayload-1"><code>payload: SpendProposalPayload</code></a></h4>
<p>The payload for the spending proposal.</p>
<ul>
<li><code>policy</code>: PublishedPolicy object.</li>
<li><code>to_address</code>: The recipient's address.</li>
<li><code>description</code>: Description of the proposal.</li>
<li><code>amountDescriptor</code>: Amount to be spent.</li>
<li><code>feeRatePriority</code>: Fee rate priority (e.g., 'low', 'medium', 'high').</li>
<li><code>policyPath</code>: Policy path.</li>
<li><code>utxos</code>: List of unspent transaction outputs (UTXOs) to be used. (Optional)</li>
<li><code>useFrozenUtxos</code>: Flag to specify whether frozen UTXOs can be used. (Optional)</li>
</ul>
<h3 id="returns-1"><a class="header" href="#returns-1">Returns</a></h3>
<pre><code class="language-typescript">Promise&lt;PublishedSpendingProposal&gt;
</code></pre>
<p>A Promise that resolves to a <code>PublishedSpendingProposal</code> object representing the published spending proposal.</p>
<h2 id="errors-1"><a class="header" href="#errors-1">Errors</a></h2>
<p>The method may throw various errors under certain conditions:</p>
<ul>
<li><strong>Invalid UTXOs</strong>: If the provided UTXOs are invalid.</li>
<li><strong>Frozen UTXOs Without Flag</strong>: If frozen UTXOs are provided but <code>useFrozenUtxos</code> is not set to <code>true</code>.</li>
<li><strong>Transaction Building Error</strong>: If an error occurs while building the transaction.</li>
<li><strong>Publishing Error</strong>: If an error occurs while publishing the proposal.</li>
</ul>
<h2 id="example-usage-1"><a class="header" href="#example-usage-1">Example Usage</a></h2>
<p>Here's an example code snippet that demonstrates how to use the <code>spend</code> method to create a spending proposal:</p>
<pre><code class="language-javascript">const payload = {
  policy: somePublishedPolicyObject,
  to_address: &quot;abc123&quot;,
  description: &quot;A spending proposal&quot;,
  amountDescriptor: 10,
  feeRatePriority: 'high',
  policyPath: new Map([['nodeId',[0,1,2]]]) // Optional but needed if the policy descriptor has more than one path,
  utxos: [&quot;utxo1&quot;, &quot;utxo2&quot;], // Optional
  useFrozenUtxos: false // Optional
};

const spendingProposal = await spend(payload);

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fetching-proposals"><a class="header" href="#fetching-proposals">Fetching Proposals</a></h1>
<h2 id="overview-2"><a class="header" href="#overview-2">Overview</a></h2>
<p>The Smart Vaults JS library  provides multiple methods for fetching proposals.</p>
<h2 id="available-methods-for-fetching-proposals"><a class="header" href="#available-methods-for-fetching-proposals">Available Methods for Fetching Proposals</a></h2>
<h3 id="1-getproposals"><a class="header" href="#1-getproposals">1. <code>getProposals()</code></a></h3>
<p>This method fetches all proposals without any filters.</p>
<pre><code class="language-javascript">const proposals = await smartVaults.getProposals();
</code></pre>
<p>Of course, you can also use it with pagination options.</p>
<pre><code class="language-javascript">const newProposals = await smartVaults.getProposals({since: someRecentDate });
</code></pre>
<h3 id="2-getproposalsbyidproposalids-array"><a class="header" href="#2-getproposalsbyidproposalids-array">2. <code>getProposalsById(proposalIds: Array)</code></a></h3>
<p>Fetches proposals based on their IDs.</p>
<pre><code class="language-javascript">const specificProposals = await smartVaults.getProposalsById([someProposalId, anotherProposalId]);
</code></pre>
<h3 id="3-getproposalsbypolicyidpolicyids-array"><a class="header" href="#3-getproposalsbypolicyidpolicyids-array">3. <code>getProposalsByPolicyId(policyIds: Array)</code></a></h3>
<p>Fetches proposals based on their associated policy IDs.</p>
<pre><code class="language-javascript">const policyBasedProposals = await smartVaults.getProposalsByPolicyId([somePolicyId, anotherPolicyId]);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="approvals-1"><a class="header" href="#approvals-1">Approvals</a></h1>
<p>We define an <code>Approval</code> as a Nostr event with kind <code>9291</code>, that (in its encryped content) contains a signed PSBT. Currently, an approval can be created in two ways:</p>
<ol>
<li>Using the Smart Vaults desktop app.</li>
<li>Using the Smart Vaults iOs app.</li>
</ol>
<h2 id="approvals-and-signers"><a class="header" href="#approvals-and-signers">Approvals and signers</a></h2>
<p>An approval can only be created using a valid signer. The valid signers are defined in the policy of the vault from which the proposal was created.</p>
<h2 id="approvals-and-proposals"><a class="header" href="#approvals-and-proposals">Approvals and proposals</a></h2>
<p>An approval is always associated with a proposal. The proposal can only be finalized when all the required approvals are created.</p>
<h2 id="fetching-approvals"><a class="header" href="#fetching-approvals">Fetching approvals</a></h2>
<p>To fecth approvals, you can use the 'getApprovals' method.</p>
<pre><code class="language-javascript">const approvals = await smartVaults.getApprovals();
</code></pre>
<p>This method retrives all the approvals that you or the members your vaults have created.</p>
<h2 id="fetching-approvals-associated-with-a-proposal"><a class="header" href="#fetching-approvals-associated-with-a-proposal">Fetching approvals associated with a proposal</a></h2>
<p>In practice, you will want to fetch the approvals associated with a given proposal. To do so, you can use the 'getApprovalsByProposalId' method.</p>
<pre><code class="language-javascript">const approvals = await smartVaults.getApprovalsByProposalId(proposalId);
</code></pre>
<h2 id="approvals-and-proposal-status"><a class="header" href="#approvals-and-proposal-status">Approvals and proposal status</a></h2>
<p>When you fetch a proposal, you can see the status of the proposal. The status can be one of the following:</p>
<ol>
<li>'Unsigned': The proposal has not been signed by all the required signers.</li>
<li>'Signed': The proposal has been signed by all the required signers.</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="completed-proposals"><a class="header" href="#completed-proposals">Completed proposals</a></h1>
<p>We define a 'Completed Proposal' as a Nostr event with Kind '9292' that (in its encryped content) contains a Bitcoin transaction.
A completed proposal can only be created when the proposal has been approved (signed) by all the participants.</p>
<h2 id="creating-a-completed-proposal"><a class="header" href="#creating-a-completed-proposal">Creating a Completed Proposal</a></h2>
<p>To create a Completed Proposal, we use the 'finalizeSpendingProposal' method.</p>
<pre><code class="language-javascript">const completedProposal = await smartVaults.finalizeSpendingProposal(proposalId);
</code></pre>
<p>The completedProposal object contains the transaction ID of the Bitcoin transaction that was broadcasted.
When the Completed Proposal is created, the associated Proposal is automatically deleted. If you decided to use frozen UXTOS, the proposals that share the same UTXOs will also be deleted.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
